{% include "head.html" %} {% include "navbar.html" %} {% include 'weightEntry.html' %}

<head>
    {% block head %}{% endblock %}

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="//cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <main>
        {% block weightEntry %} {% endblock weightEntry %}

        <div id="tester"></div>
        <div id="debug"></div>

        <script>
            $(document).ready(function() {

                DEBUG = document.getElementById('debug')

                $.ajax({
                    type: "GET",
                    url: "http://192.168.1.63:8080/api/json/lastfifty",
                    dataType: 'json',
                    success: function(data) {
                        plotInit(data)
                        console.log(data)
                        fillTable(data)
                        $('#table').DataTable();
                    },
                    error: function(error) {
                        console.log("Here is the error res: " + JSON.stringify(error));
                    }
                });
            });

            function plotDataMaker(data) {
                var i;
                let arr = Array(10)
                for (i = 0; i < data.length; i++) {
                    arr[i] = data[i]['weight']
                }
                return arr
            }

            [{
                "id": 500,
                "timestamp": 1587466538,
                "weight": 67.84
            }, {
                "id": 499,
                "timestamp": 1590199288,
                "weight": 81.41
            }]

            function plotInit(data) {
                TESTER = document.getElementById('tester');
                Plotly.newPlot(TESTER, [{
                    //x: [1, 2, 3, 4, 5],
                    y: plotDataMaker(data)
                }], {
                    margin: {
                        t: 0
                    }
                });
            }

            function fillTable(response) {
                $.each(response, function(i, item) {
                    var $tr = $('#table').append(
                        '<tr id="table"> \
                <td>' + (item.id) + '</td> \
                <td>' + (item.weight) + " kg" + '</td> \
                <td>' + (item.timestamp) + '</td> \
                </tr>'
                    ).appendTo('#table');
                });
            }
        </script>
        {% block navbar %} {% endblock navbar %}
    </main>

    <script>
        $(document).ready(function() {

        });
    </script>
</body>